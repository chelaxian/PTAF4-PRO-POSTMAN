{
	"info": {
		"_postman_id": "a0c66ee3-53bc-491a-92c4-cafb0f7c0f6e",
		"name": "Fix Bags",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"description": "–ö–æ–ª–ª–µ–∫—Ü–∏—è API-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è PTAF PRO 2",
		"version": "2.0"
	},
	"item": [
		{
			"name": "Clear CVES (Bug - Exclusion cannot be saved)",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"// –í—ã–±–∏—Ä–∞–µ–º —Ç–æ–∫–µ–Ω: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É access_token_target_tenant, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç ‚Äî –±–µ—Ä—ë–º access_token\r",
							"var token = pm.environment.get(\"access_token_target_tenant\") || pm.environment.get(\"access_token\");\r",
							"\r",
							"if (!token) {\r",
							"    console.log(\"‚ö†Ô∏è –û—à–∏–±–∫–∞: –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!\");\r",
							"    pm.environment.unset(\"all_policy_id\"); // –ß–∏—Å—Ç–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –µ—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø—Ä–æ—Å–∞\r",
							"} else {\r",
							"    console.log(\"üîê –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω:\", token);\r",
							"    pm.variables.set(\"token\", token);\r",
							"}\r",
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"// –ü–∞—Ä—Å–∏–º JSON-–æ—Ç–≤–µ—Ç\r",
							"var jsonData = pm.response.json();\r",
							"\r",
							"// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å–ø–µ—à–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–æ\r",
							"if (pm.response.code === 200) {\r",
							"    console.log(`‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–æ ${pm.globals.get(\"target_rule_id\")} –≤ –ø–æ–ª–∏—Ç–∏–∫–µ ${pm.globals.get(\"target_policy_id\")}`);\r",
							"} else {\r",
							"    console.log(\"‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞:\", pm.response.code);\r",
							"}\r",
							"\r",
							"// –õ–æ–≥–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç API\r",
							"console.log(\"‚ÑπÔ∏è –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:\", JSON.stringify(jsonData, null, 2));\r",
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"protocolProfileBehavior": {
				"disabledSystemHeaders": {
					"content-length": true,
					"host": true,
					"user-agent": true,
					"accept": true,
					"accept-encoding": true,
					"connection": true
				}
			},
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"variables\": {\r\n        \"checks\": [\r\n            \"common\",\r\n            \"sql\",\r\n            \"java\",\r\n            \"php\",\r\n            \"iis\",\r\n            \"apache\",\r\n            \"nginx\",\r\n            \"portal_login\",\r\n            \"version_leakage\",\r\n            \"api_credentials\"\r\n        ]\r\n    }\r\n}\r\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/ptaf/v4/config/policies/templates/user/{{target_policy_id}}/rules/{{target_rule_id}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"ptaf",
						"v4",
						"config",
						"policies",
						"templates",
						"user",
						"{{target_policy_id}}",
						"rules",
						"{{target_rule_id}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Add \"Send to SIEM\" action to rule",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"// –í—ã–±–∏—Ä–∞–µ–º —Ç–æ–∫–µ–Ω: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É access_token_target_tenant, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç ‚Äî –±–µ—Ä—ë–º access_token\r",
							"var token = pm.environment.get(\"access_token_target_tenant\") || pm.environment.get(\"access_token\");\r",
							"\r",
							"if (!token) {\r",
							"    console.log(\"‚ö†Ô∏è –û—à–∏–±–∫–∞: –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!\");\r",
							"    pm.environment.unset(\"all_policy_id\"); // –ß–∏—Å—Ç–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –µ—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø—Ä–æ—Å–∞\r",
							"} else {\r",
							"    console.log(\"üîê –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω:\", token);\r",
							"    pm.variables.set(\"token\", token);\r",
							"}\r",
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"// –ü–∞—Ä—Å–∏–º JSON-–æ—Ç–≤–µ—Ç\r",
							"var jsonData = pm.response.json();\r",
							"\r",
							"// –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞\r",
							"if (pm.response.code === 200) {\r",
							"    console.log(`‚úÖ –£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—è –≤ –ø—Ä–∞–≤–∏–ª–æ ${pm.globals.get(\"target_rule_id\")} –ø–æ–ª–∏—Ç–∏–∫–∏ ${pm.globals.get(\"target_policy_id\")}`);\r",
							"} else {\r",
							"    console.log(\"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–µ–π—Å—Ç–≤–∏–π:\", pm.response.code);\r",
							"}\r",
							"\r",
							"// –õ–æ–≥–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç API\r",
							"console.log(\"‚ÑπÔ∏è –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:\", JSON.stringify(jsonData, null, 2));\r",
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"protocolProfileBehavior": {
				"disabledSystemHeaders": {
					"content-length": true,
					"host": true,
					"user-agent": true,
					"accept": true,
					"accept-encoding": true,
					"connection": true
				}
			},
			"request": {
				"auth": {
					"type": "noauth"
				},
				"method": "PATCH",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"actions\": [\r\n        \"{{action_log_to_db_id}}\",\r\n        \"{{action_block_id}}\",\r\n        \"{{action_log_to_siem_id}}\"\r\n    ]\r\n}\r\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/ptaf/v4/config/policies/templates/user/{{target_policy_id}}/rules/{{target_rule_id}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"ptaf",
						"v4",
						"config",
						"policies",
						"templates",
						"user",
						"{{target_policy_id}}",
						"rules",
						"{{target_rule_id}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Reset General Pod to defaults (4ram/1cpu/2pods)",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"traffic_processing\":{\"pod_size\":\"base\",\"min_pods_per_node\":2,\"max_pods_per_node\":15,\"min_pods\":1,\"max_pods\":30},\"administrator\":{\"password\":\"{{password}}\"}}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/ptaf/v4/auth/tenants/00000000-0000-0000-0000-000000000000",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"ptaf",
						"v4",
						"auth",
						"tenants",
						"00000000-0000-0000-0000-000000000000"
					]
				}
			},
			"response": []
		},
		{
			"name": "Reset Custom Pod to defaults (4ram/1cpu/2pods)",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"name\":\"{{tenant_name}}\",\"description\":\"{{tenant_description}}\",\"is_active\":true,\"traffic_processing\":{\"pod_size\":\"base\",\"min_pods_per_node\":2,\"max_pods_per_node\":15,\"min_pods\":1,\"max_pods\":30},\"administrator\":{\"email\":\"{{tenant_email}}\",\"description\":\"{{tenant_admin}}\",\"password\":\"{{tenant_password}}\",\"is_active\":true,\"password_change_required\":false}}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/ptaf/v4/auth/tenants/{{target_tenant_id}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"ptaf",
						"v4",
						"auth",
						"tenants",
						"{{target_tenant_id}}"
					]
				}
			},
			"response": []
		}
	]
}
